<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2B3A67" />
  <title>Xanaes Lab</title>
  <link rel="manifest" href="assets/manifest.json" />
  <link rel="icon" href="assets/favicon.ico" />
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <header class="app-header" role="banner">
    <div class="branding">
      <img src="assets/logo.svg" alt="Xanaes Lab" class="logo" />
      <div>
        <h1>Xanaes Lab</h1>
        <p class="tagline">Comparador de precios para Río Segundo y Pilar</p>
      </div>
    </div>
    <nav aria-label="Secciones principales">
      <button class="nav-link" data-view="home" aria-controls="view-home">Inicio</button>
      <button class="nav-link" data-view="import" aria-controls="view-import">Importar CSV</button>
      <button class="nav-link" data-view="compare" aria-controls="view-compare">Comparador</button>
      <button class="nav-link" data-view="cart" aria-controls="view-cart">Changuito</button>
      <button class="nav-link" data-view="map" aria-controls="view-map">Mapa</button>
      <button class="nav-link" data-view="about" aria-controls="view-about">Acerca de</button>
    </nav>
  </header>

  <main id="app" tabindex="-1">
    <section id="view-home" class="view" aria-labelledby="home-title">
      <div class="home-hero">
        <h2 id="home-title">Bienvenido a Xanaes Lab</h2>
        <p>Elegí tu ciudad favorita, buscá productos y mantené tu changuito siempre con los mejores precios locales.</p>
        <div class="home-actions">
          <div class="field">
            <label for="home-city-select">Ciudad por defecto</label>
            <select id="home-city-select"></select>
          </div>
          <div class="field">
            <label class="toggle">
              <input type="checkbox" id="home-include-banks" />
              <span>Incluir precios con banco</span>
            </label>
          </div>
          <div class="cta-buttons">
            <button data-view="import" class="primary">Importar CSV</button>
            <button data-view="compare" class="secondary">Ir al comparador</button>
            <button data-view="map" class="secondary">Mapa de supermercados</button>
          </div>
        </div>
        <section aria-live="polite" class="summary-board">
          <h3>Estado de datos</h3>
          <dl>
            <div>
              <dt>Última importación</dt>
              <dd id="summary-last-import">-</dd>
            </div>
            <div>
              <dt>Ofertas vigentes</dt>
              <dd id="summary-offers-count">0</dd>
            </div>
            <div>
              <dt>Productos distintos</dt>
              <dd id="summary-products-count">0</dd>
            </div>
          </dl>
        </section>
      </div>
    </section>

    <section id="view-import" class="view" aria-labelledby="import-title" hidden>
      <header class="view-header">
        <h2 id="import-title">Importar ofertas desde CSV</h2>
        <p>Usá el contrato oficial y revisá las validaciones antes de guardar en tu dispositivo.</p>
      </header>
      <form id="import-form" class="card" aria-describedby="import-instructions">
        <div class="field">
          <label for="import-file">Archivo CSV</label>
          <input type="file" id="import-file" accept=".csv" required />
        </div>
        <p id="import-instructions" class="help">Cabecera esperada: supermercado, ciudad, categoría, producto, marca, presentación, ...</p>
        <div class="actions">
          <button type="submit" class="primary">Previsualizar</button>
          <button type="button" id="import-clear" class="secondary">Limpiar base local</button>
          <button type="button" id="export-json" class="secondary">Exportar JSON</button>
          <button type="button" id="export-csv" class="secondary">Exportar CSV</button>
        </div>
      </form>
      <section class="card" aria-live="polite">
        <header>
          <h3>Previsualización y validaciones</h3>
          <p id="preview-summary">Aún no se cargó ningún archivo.</p>
        </header>
        <div class="table-container">
          <table id="preview-table">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
        <footer class="import-footer">
          <div id="import-stats"></div>
          <button type="button" id="confirm-import" class="primary" disabled>Importar y guardar</button>
          <button type="button" id="download-errors" class="secondary" disabled>Descargar errores</button>
        </footer>
      </section>
    </section>

    <section id="view-compare" class="view" aria-labelledby="compare-title" hidden>
      <header class="view-header">
        <h2 id="compare-title">Comparador de precios</h2>
        <div class="filters" role="group" aria-label="Filtros de comparador">
          <div class="field">
            <label for="compare-city">Ciudad</label>
            <select id="compare-city"></select>
          </div>
          <div class="field">
            <label for="compare-category">Categoría</label>
            <select id="compare-category"></select>
          </div>
          <div class="field">
            <label for="compare-date-from">Vigencia desde</label>
            <input type="date" id="compare-date-from" />
          </div>
          <div class="field">
            <label for="compare-date-to">Vigencia hasta</label>
            <input type="date" id="compare-date-to" />
          </div>
          <div class="field">
            <label class="toggle">
              <input type="checkbox" id="compare-include-banks" />
              <span>Incluir bancos</span>
            </label>
          </div>
          <div class="field">
            <label class="toggle">
              <input type="checkbox" id="compare-raw-prices" />
              <span>Ver precio sin promo</span>
            </label>
          </div>
          <div class="field">
            <label for="compare-search">Buscar</label>
            <input type="search" id="compare-search" placeholder="Nombre, marca o presentación" />
          </div>
        </div>
      </header>
      <section class="card">
        <div class="table-container" id="compare-results" aria-live="polite"></div>
      </section>
    </section>

    <section id="view-cart" class="view" aria-labelledby="cart-title" hidden>
      <header class="view-header">
        <h2 id="cart-title">Armá tu changuito</h2>
        <div class="field">
          <label for="cart-search">Buscar productos</label>
          <input type="search" id="cart-search" placeholder="Ej: Yerba, Lavandina" />
        </div>
      </header>
      <section class="card">
        <div id="cart-search-results" class="list"></div>
      </section>
      <section class="card">
        <header>
          <h3>Resumen por supermercado</h3>
          <p id="cart-note"></p>
        </header>
        <div id="cart-totals" class="list"></div>
      </section>
    </section>

    <section id="view-map" class="view" aria-labelledby="map-title" hidden>
      <header class="view-header">
        <h2 id="map-title">Supermercados</h2>
        <p>Listado enriquecido con direcciones locales. Abrí cada uno en tu app de mapas favorita.</p>
      </header>
      <section class="card">
        <div id="map-list" class="list" aria-live="polite"></div>
      </section>
    </section>

    <section id="view-about" class="view" aria-labelledby="about-title" hidden>
      <header class="view-header">
        <h2 id="about-title">Acerca de y preferencias</h2>
      </header>
      <section class="card preferences">
        <h3>Preferencias</h3>
        <div class="field">
          <label for="preferences-city">Ciudad predeterminada</label>
          <select id="preferences-city"></select>
        </div>
        <div class="field">
          <label class="toggle">
            <input type="checkbox" id="preferences-include-banks" />
            <span>Incluir precios con banco</span>
          </label>
        </div>
        <div class="field">
          <label for="preferences-sort">Orden inicial</label>
          <select id="preferences-sort">
            <option value="precio">Mejor precio</option>
            <option value="vigencia">Vigencia más reciente</option>
            <option value="supermercado">Nombre de supermercado</option>
          </select>
        </div>
      </section>
      <section class="card">
        <h3>Última importación</h3>
        <p id="about-last-import">No hay datos importados.</p>
        <h3>Versión de datos</h3>
        <p id="about-data-version">-</p>
        <h3>Avisos legales</h3>
        <p>Precios y vigencias según revista o terceros. Verificá condiciones con cada supermercado o banco.</p>
      </section>
    </section>
  </main>

  <footer class="app-footer">
    <p>Xanaes Lab &copy; <span id="current-year"></span>. Datos locales para el Valle del Xanaes.</p>
    <a href="admin/index.html" class="admin-link">Panel administrador</a>
  </footer>

  <script type="module" src="scripts/app.js"></script>
</body>
</html>
